<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>二營健康管理中心</title>
  <style>
    *,*::before,*::after{ box-sizing:border-box; }
    html,body{ width:100%; max-width:100%; overflow-x:hidden; -webkit-text-size-adjust:100%; margin:0; }
    :root{
      --hdr-a:#0f5fb6; --hdr-b:#2382e0;
      --bg-a:#0f5fb6; --bg-b:#2382e0;
      --ink:#111; --ink-dim:#334155;
      --card:#ffffff; --card-b:#e5e7eb;
      --btn-blue:#1766d8; --btn-green:#24a35f;
    }
    body{
      background: linear-gradient(180deg, var(--bg-a) 0%, var(--bg-b) 72%, #f7fafc 100%);
      background-size:200% 200%;
      animation:bg-shift 18s ease-in-out infinite;
    }
    @keyframes bg-shift {
      0%{background-position:0% 0%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 0%;}
    }
    @media (prefers-reduced-motion: reduce){ body{ animation:none; } }
    header{
      color:#fff; padding:1.1rem 1rem .9rem; text-align:center;
      background: linear-gradient(135deg,var(--hdr-a),var(--hdr-b));
      border-bottom:1px solid rgba(255,255,255,.35);
    }
    h1{ margin:0; font-size:1.6rem; letter-spacing:.02em; }
    #marquee{ overflow:hidden; white-space:nowrap; animation:marquee 28s linear infinite;
              font-weight:800; margin-top:.35rem; opacity:.95; }
    @keyframes marquee{0%{transform:translateX(100%);}100%{transform:translateX(-100%);}}
    main{ padding:1.2rem 0 2.2rem; flex:1; }
    .wrap{ max-width:520px; margin:0 auto; padding:0 16px; }
    .card{
      background:rgba(255,255,255,.78); border:1px solid var(--card-b);
      border-radius:16px; padding:1.25rem; box-shadow:0 10px 24px rgba(0,0,0,.08);
      backdrop-filter:blur(6px); text-align:left; margin-bottom:1.6rem;
      opacity:0; transform:translateY(6px);
      transition:opacity .28s ease, transform .28s ease;
    }
    .card.show{ opacity:1; transform:none; }
    .card h2{ margin:.2rem 0 .6rem; font-size:1.25rem; }
    a.btn, button.btn{ display:inline-flex; align-items:center; justify-content:center;
      width:100%; margin:.8rem 0; padding:1rem;
      font-size:1rem; font-weight:800; border:none; border-radius:16px; color:#fff;
      text-decoration:none; box-shadow:0 3px 10px rgba(0,0,0,.14);
      transition: filter .15s ease, transform .05s ease; }
    .btn:hover{ filter:brightness(1.03); }
    .btn:active{ transform:translateY(1px); }
    .primary{ background:linear-gradient(180deg, var(--btn-blue), #3a86e9); }
    .secondary{ background:linear-gradient(180deg, var(--btn-green), #1e8f54); }
    footer{ margin-top:auto; display:flex; justify-content:center; padding:16px; background:transparent; }
    .footer-card {
      background:#fff; border-radius:8px; padding:6px 12px; font-size:12px;
      text-align:center; color:#333; position:fixed; bottom:8px; left:50%;
      transform:translateX(-50%); box-shadow:0 2px 6px rgba(0,0,0,0.1); z-index:1000;
    }
    .modal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.55);
            padding:12px; z-index:100; }
    .modal[open]{ display:block; }
    .modal-content{
      background:#fff; color:#000; width:calc(100% - 24px); max-width:720px;
      margin:0 auto; padding:18px; border-radius:18px; border:1px solid #e5e7eb;
      max-height:90vh; overflow:auto; box-shadow:0 12px 32px rgba(0,0,0,.20);
    }
    .modal-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:.4rem; }
    .close{ background:none; border:none; font-size:28px; cursor:pointer; color:#2563eb; }
    .fields{ display:flex; gap:.75rem; flex-wrap:wrap; margin:.2rem 0 .75rem; }
    .field{ display:flex; flex-direction:column; gap:.35rem; font-weight:800; color:#111; }
    .field input, .field select{
      width:210px; max-width:210px; background:#fff; border:1px solid #d1d5db; border-radius:12px;
      padding:.55rem .8rem; font-size:.95rem;
    }
    .modal-actions{ display:flex; gap:.9rem; margin:.4rem 0 1rem; }
    .modal-actions .btn{ flex:1; margin:0; min-width:0; padding:.95rem; border-radius:20px; }
    .grid{ display:grid; gap:.85rem; grid-template-columns:1fr; }
    .menu{ border:1px solid #e5e7eb; border-radius:16px; padding:1rem; background:#fff; color:#000; }
    .menu h3{ margin:.2rem 0 .5rem; font-size:1.15rem; font-weight:900; }
    .meta{ font-size:.95rem; color:#334155; }
    .pill{ display:inline-block; padding:.32rem .6rem; margin-right:.35rem; border-radius:999px;
           border:1px solid #e5e7eb; background:#f8fafc; color:#475569; font-size:.82rem; font-weight:800; }
    .note{ margin:.45rem 0 0; font-size:.88rem; color:#475569; }
    #calories{ margin-top:.6rem; font-weight:900; }
    .badge{ display:inline-block; padding:.3rem .6rem; border-radius:999px; border:1px solid #f2f2f2; font-size:.82rem; margin-bottom:.35rem; }
    .badge.b{ background:#fff2ec; color:#b93815; }
    .badge.l{ background:#eef5ff; color:#0b6bcf; }
    .badge.d{ background:#ecfdf3; color:#067647; }
    /* 標題動畫 */
    .title-bounce{ display:inline-block; animation:bounce 1.5s infinite; }
    @keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0);}40%{transform:translateY(-8px);}60%{transform:translateY(-4px);}}
    .title-breath{ animation:breath 3s ease-in-out infinite; }
    @keyframes breath{0%,100%{transform:scale(1);opacity:1;}50%{transform:scale(1.05);opacity:.85;}}
/* 讓 conic-gradient 的角度可以被動畫控制 */
@property --angle {
  syntax: '<angle>';
  initial-value: 0deg;
  inherits: false;
}

/* 今日小挑戰：外框顏色流動，但盒子不旋轉 */
.challenge { position: relative; isolation: isolate; }

.challenge::before{
  content:"";
  position:absolute;
  inset:-2px;               /* 邊框厚度 */
  padding:2px;
  border-radius:16px;

  /* 只改「角度」流動，不轉整塊元素 */
  background: conic-gradient(
    from var(--angle),
    #2dd4bf, #22d3ee, #60a5fa, #a78bfa, #34d399, #2dd4bf
  );

  /* 內挖（只留外框） */
  -webkit-mask: 
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;

  /* 角度從 0 → 360 度，呈現顏色繞行 */
  animation: angle-sweep 8s linear infinite;
  z-index:-1;
}
@keyframes angle-sweep { 
  to { --angle: 360deg; } 
}
/* 使用者偏好減少動態時停用 */
@media (prefers-reduced-motion: reduce){
  .challenge::before{ animation:none; }
}
    </style>
</head>
<body>
<header>
 <h1 id="main-title">二營健康管理中心</h1>
 <div id="marquee">健康標語載入中...</div>
</header>
<main>
  <div class="wrap">
    <section class="card">
      <h2>今日值班人員</h2>
      <p>少尉鍾俊佑 <a href="tel:0938000372">0938-000-372</a><br>上士李啟祥 <a href="tel:0955797745">0955-797-745</a></p>
      <small id="dutyWindow" data-auto="1" data-cycle="wed" data-length="7">值班時間：114年08月20日 ～ 114年08月27日</small>
    </section>
    <section class="card challenge">
      <h2>今日小挑戰</h2>
      <p>🏃‍♂️ 快走 15 分鐘，保持心肺健康！</p>
    </section>
    <a id="bmiLink" class="btn primary" href="https://forms.gle/cr3efubbA1WoArfp6" target="_blank">BMI 回報</a>
    <button id="menuBtn" class="btn secondary" type="button">今日建議菜單</button>
  </div>
</main>
<div id="menuModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="menuTitle">今日建議菜單</h2>
      <button id="closeMenu" class="close">&times;</button>
    </div>
    <div class="fields">
      <label class="field">飲食偏好：<select id="dietSelect">
        <option value="all">不限制</option><option value="veg">素食（嚴格）</option>
        <option value="hp">高蛋白</option><option value="lc">低醣</option>
      </select></label>
      <label class="field">每天目標熱量(kcal)：
        <input id="calTarget" type="number" placeholder="例如 1800" min="800" max="4000" step="50">
      </label>
    </div>
    <div class="modal-actions">
      <button id="randBtn" class="btn primary" type="button">隨機菜單</button>
      <button id="byWeekBtn" class="btn secondary" type="button">依星期菜單</button>
    </div>
    <div id="menuList" class="grid"></div>
    <p id="calories"></p>
    <p id="warn" style="display:none;color:#b45309;background:#fff7ed;border:1px solid #fed7aa;padding:.6rem .8rem;border-radius:10px;font-weight:700;"></p>
  </div>
</div>
<footer><div class="footer-card">&copy; <span id="rocYear"></span> 二營健康管理中心</div></footer>
<script>
// 隨機主題色
const THEMES=[{a:"#0f5fb6",b:"#2382e0",midA:"#0f5fb6",midB:"#2382e0"},
{a:"#6a11cb",b:"#2575fc",midA:"#5f65d6",midB:"#6bb0ff"},
{a:"#d53369",b:"#daae51",midA:"#d64467",midB:"#e9c074"},
{a:"#11998e",b:"#38ef7d",midA:"#158f86",midB:"#7cefa4"}];
const theme=THEMES[Math.floor(Math.random()*THEMES.length)];
for(const[k,v]of Object.entries({'--hdr-a':theme.a,'--hdr-b':theme.b,'--bg-a':theme.midA,'--bg-b':theme.midB}))
 document.documentElement.style.setProperty(k,v);
// 標語
const slogans=["均衡飲食，體能常青","多喝水，少喝含糖飲料","睡眠充足，精神百倍","規律運動，強健體魄"];
document.getElementById('marquee').textContent=slogans[Math.floor(Math.random()*slogans.length)];
// 標題動畫
(()=>{const title=document.getElementById('main-title');if(!title)return;
 const effects=['title-bounce','title-breath'];title.classList.add(effects[Math.floor(Math.random()*effects.length)]);})();
// Duty window
(()=>{const el=document.getElementById('dutyWindow');if(!el)return;
 const pad2=n=>String(n).padStart(2,'0');const toRoc=d=>`${d.getFullYear()-1911}年${pad2(d.getMonth()+1)}月${pad2(d.getDate())}日`;
 if(el.dataset.auto==='1'){const map={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6};
  const startDow=map[el.dataset.cycle||'wed'];const len=parseInt(el.dataset.length||'7',10);
  const now=new Date();const diff=(now.getDay()-startDow+7)%7;
  const s=new Date(now);s.setDate(now.getDate()-diff);s.setHours(0,0,0,0);
  const e=new Date(s);e.setDate(s.getDate()+len);e.setHours(23,59,59,999);
  el.textContent=`值班時間：${toRoc(s)} ～ ${toRoc(e)}`;}
 document.getElementById('rocYear').textContent=String(new Date().getFullYear()-1911);})();
</script>
  <script>
document.addEventListener('DOMContentLoaded', () => {
  // 讓所有卡片依序淡入顯示（值班人員 + 今日小挑戰）
  const cards = document.querySelectorAll('.card');
  cards.forEach((el, i) => {
    setTimeout(() => el.classList.add('show'), 80 + i * 60);
  });
});
</script>
  <script>
// ===== 菜單資料池（含標籤：veg=素食、lc=低醣、hp=高蛋白） =====
const breakfastPool = [
  {name:"全麥吐司＋低脂牛奶", kcal:300, tags:[]},
  {name:"燕麥＋水煮蛋＋無糖豆漿", kcal:350, tags:["hp","veg"]},
  {name:"無糖優格＋堅果＋水果", kcal:300, tags:["veg","lc"]},
  {name:"水煮蛋＋燕麥粥", kcal:340, tags:["hp"]},
  {name:"全麥饅頭＋豆漿", kcal:360, tags:["veg"]},
  {name:"水煮蛋＋黑咖啡＋水果", kcal:260, tags:["lc","hp"]},
  {name:"燕麥片＋堅果＋牛奶", kcal:370, tags:[]},
  {name:"豆漿＋地瓜＋時蔬", kcal:320, tags:["veg"]},
  {name:"蔬菜蛋餅（少油）＋無糖茶", kcal:330, tags:["lc"]},
  {name:"優格水果碗＋奇亞籽", kcal:310, tags:["veg","lc"]}
];
const lunchPool = [
  {name:"雞胸肉＋糙米＋燙青菜", kcal:500, tags:["hp"]},
  {name:"鮭魚＋糙米＋青花菜", kcal:560, tags:["hp","lc"]},
  {name:"雞腿排＋糙米＋時蔬", kcal:540, tags:["hp"]},
  {name:"牛肉片＋地瓜＋青菜", kcal:560, tags:["hp"]},
  {name:"鮭魚＋地瓜＋青菜", kcal:540, tags:["hp","lc"]},
  {name:"雞胸肉便當（半飯）＋時蔬", kcal:500, tags:["hp","lc"]},
  {name:"菇菇時蔬炒麵＋水煮蛋", kcal:520, tags:["veg"]},
  {name:"豆腐時蔬蓋飯（半飯）", kcal:480, tags:["veg","lc"]},
  {name:"蒜香杏鮑菇＋藜麥沙拉", kcal:450, tags:["veg","lc"]},
  {name:"日式豆腐鍋＋蔬菜＋少量白飯", kcal:520, tags:["veg"]}
];
const dinnerPool = [
  {name:"蔬菜湯＋豆腐＋水果", kcal:300, tags:["veg","lc"]},
  {name:"蒸蛋＋炒菠菜＋水果", kcal:320, tags:["veg","lc"]},
  {name:"豆漿＋雞胸沙拉", kcal:290, tags:["lc"]},
  {name:"味噌湯＋豆腐＋水果", kcal:310, tags:["veg","lc"]},
  {name:"蔬菜湯＋雞蛋＋水果", kcal:290, tags:["veg","lc"]},
  {name:"豆漿＋炒青菜", kcal:270, tags:["veg","lc"]},
  {name:"蒸鱸魚＋花椰菜＋山藥", kcal:340, tags:["hp","lc"]},
  {name:"番茄豆腐鍋＋時蔬", kcal:320, tags:["veg"]},
  {name:"玉米筍炒菇＋涼拌豆干", kcal:300, tags:["veg","lc"]},
  {name:"烤雞腿＋沙拉（無醬）", kcal:330, tags:["hp","lc"]}
];

// ===== 依星期的預設菜單（0=週日…6=週六） =====
const menusByWeek = [
  [{t:"早餐", name:"全麥吐司＋低脂牛奶", kcal:300, tags:[]},
   {t:"午餐", name:"鮭魚＋糙米＋青花菜", kcal:560, tags:["hp","lc"]},
   {t:"晚餐", name:"蔬菜湯＋豆腐＋水果", kcal:300, tags:["veg","lc"]}],
  [{t:"早餐", name:"燕麥＋水煮蛋＋無糖豆漿", kcal:350, tags:["hp","veg"]},
   {t:"午餐", name:"雞胸肉＋糙米＋燙青菜", kcal:500, tags:["hp"]},
   {t:"晚餐", name:"蒸蛋＋炒菠菜＋水果", kcal:320, tags:["veg","lc"]}],
  [{t:"早餐", name:"無糖優格＋堅果＋水果", kcal:300, tags:["veg","lc"]},
   {t:"午餐", name:"雞腿排＋糙米＋時蔬", kcal:540, tags:["hp"]},
   {t:"晚餐", name:"豆漿＋雞胸沙拉", kcal:290, tags:["lc"]}],
  [{t:"早餐", name:"水煮蛋＋燕麥粥", kcal:340, tags:["hp"]},
   {t:"午餐", name:"牛肉片＋地瓜＋青菜", kcal:560, tags:["hp"]},
   {t:"晚餐", name:"味噌湯＋豆腐＋水果", kcal:310, tags:["veg","lc"]}],
  [{t:"早餐", name:"全麥饅頭＋豆漿", kcal:360, tags:["veg"]},
   {t:"午餐", name:"菇菇時蔬炒麵＋水煮蛋", kcal:520, tags:["veg"]},
   {t:"晚餐", name:"蔬菜湯＋雞蛋＋水果", kcal:290, tags:["veg","lc"]}],
  [{t:"早餐", name:"水煮蛋＋黑咖啡＋水果", kcal:260, tags:["lc","hp"]},
   {t:"午餐", name:"鮭魚＋地瓜＋青菜", kcal:540, tags:["hp","lc"]},
   {t:"晚餐", name:"豆漿＋炒青菜", kcal:270, tags:["veg","lc"]}],
  [{t:"早餐", name:"燕麥片＋堅果＋牛奶", kcal:370, tags:[]},
   {t:"午餐", name:"雞胸肉便當（半飯）＋時蔬", kcal:500, tags:["hp","lc"]},
   {t:"晚餐", name:"番茄豆腐鍋＋時蔬", kcal:320, tags:["veg"]}]
];

// ===== 工具 =====
function shuffle(a){ const b=[...a]; for(let i=b.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [b[i],b[j]]=[b[j],b[i]];} return b; }
function pickFromPool(pool, filterTag, need=1){
  const list = filterTag ? pool.filter(x => (x.tags||[]).includes(filterTag)) : pool.slice();
  return shuffle(list).slice(0, need);
}
function currentDayList(){ return menusByWeek[new Date().getDay()]; }

// ===== 偏好邏輯（veg 嚴格 / hp 高蛋白 / lc 低醣） =====
function buildByPreference(pref){
  const warn = document.getElementById('warn');
  warn.style.display = 'none';

  if (pref === 'veg') {
    const b = pickFromPool(breakfastPool, 'veg', 1);
    const l = pickFromPool(lunchPool, 'veg', 1);
    const d = pickFromPool(dinnerPool, 'veg', 1);
    const chosen = [
      {t:"早餐", ...(b[0]||{name:"（缺項）",kcal:0,tags:["veg"]})},
      {t:"午餐", ...(l[0]||{name:"（缺項）",kcal:0,tags:["veg"]})},
      {t:"晚餐", ...(d[0]||{name:"（缺項）",kcal:0,tags:["veg"]})}
    ];
    if(!b.length || !l.length || !d.length){
      warn.textContent = "⚠️ 素食嚴格模式下，今日菜單池不足，請手動補齊或調整偏好。";
      warn.style.display = 'block';
    }
    return chosen;
  }

  const tag = (pref==='hp' || pref==='lc') ? pref : null;
  const pickOrFallback = (pool)=>{
    const primary = pickFromPool(pool, tag, 1);
    if(primary.length) return primary[0];
    return shuffle(pool)[0];
  };
  return [
    {t:"早餐", ...pickOrFallback(breakfastPool)},
    {t:"午餐", ...pickOrFallback(lunchPool)},
    {t:"晚餐", ...pickOrFallback(dinnerPool)}
  ];
}

// ===== 顯示（含目標熱量差距、標籤膠囊） =====
function render(list){
  const badgeClass = t => t==="早餐"?"b":(t==="午餐"?"l":"d");
  document.getElementById("menuList").innerHTML = list.map(i=>`
    <article class="menu">
      <span class="badge ${badgeClass(i.t)}">${i.t}</span>
      <h3>${i.name}</h3>
      <p class="meta">熱量：約 ${i.kcal} kcal ${(i.tags||[]).map(tag=>`<span class="pill">${tag}</span>`).join("")}</p>
      <p class="note">建議：餐盤 1/2 蔬菜、1/4 蛋白、1/4 全穀；外食可減飯半碗或去皮。</p>
    </article>
  `).join("");

  const total = list.reduce((a,b)=>a+(b.kcal||0),0);
  const target = parseInt(document.getElementById('calTarget').value||"0",10);
  const delta = target? `（與目標差距：約 ${Math.abs(total-target)} kcal ${total>target?"可減少":"可加餐"}）` : "";
  document.getElementById("calories").textContent = `每日總熱量：約 ${total} kcal ${delta}`;
}

// ===== 依星期（週表）但支援 veg 嚴格替換 =====
function renderByWeekWithPreference(){
  const pref = document.getElementById('dietSelect').value;
  if (pref !== 'veg') { document.getElementById('warn').style.display='none'; return render(currentDayList()); }

  const source = currentDayList();
  const replaced = source.map(item=>{
    if((item.tags||[]).includes('veg')) return item;
    const pool = item.t==="早餐" ? breakfastPool : (item.t==="午餐" ? lunchPool : dinnerPool);
    const alt = pool.filter(x=> (x.tags||[]).includes('veg'));
    return {t:item.t, ...(alt.length? alt[Math.floor(Math.random()*alt.length)] : {name:"（缺項）",kcal:0,tags:["veg"]})};
  });
  const warn = document.getElementById('warn');
  if(replaced.some(x=>x.name==="（缺項）")){
    warn.textContent = "⚠️ 素食嚴格模式下，依星期菜單含有缺項，請手動補齊或改用抽籤。";
    warn.style.display = 'block';
  }else{
    warn.style.display = 'none';
  }
  render(replaced);
}

// ===== 事件：開啟 modal 時預先載入「依星期」菜單 =====
document.getElementById('menuBtn').addEventListener('click', ()=>{
  document.getElementById('warn').style.display='none';
  renderByWeekWithPreference();
});

// ===== 事件：隨機菜單（依偏好抽） =====
document.getElementById('randBtn').addEventListener('click', ()=>{
  const pref = document.getElementById('dietSelect').value;
  render(buildByPreference(pref));
});

// ===== 事件：依星期菜單（遇 veg 嚴格會替換） =====
document.getElementById('byWeekBtn').addEventListener('click', renderByWeekWithPreference);
</script>
  <script>
  // === 今日建議菜單 modal 開關 ===
  const modal    = document.getElementById('menuModal');
  const openBtn  = document.getElementById('menuBtn');
  const closeBtn = document.getElementById('closeMenu');

  function openModal() {
    modal.setAttribute('open', '');
    document.body.style.overflow = 'hidden';   // 鎖背景卷動
  }
  function closeModal() {
    modal.removeAttribute('open');
    document.body.style.overflow = '';
  }

  openBtn.addEventListener('click', openModal);
  closeBtn.addEventListener('click', closeModal);
  // 點遮罩關閉
  modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
  // ESC 關閉（可選）
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });
</script>
</body>
</html>
