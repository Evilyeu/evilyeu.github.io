<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>äºŒç‡Ÿå¥åº·ç®¡ç†ä¸­å¿ƒ</title>
  <style>
    *,*::before,*::after{ box-sizing:border-box; }
    html,body{ width:100%; max-width:100%; overflow-x:hidden; -webkit-text-size-adjust:100%; }
    :root{
      --hdr-a:#0f5fb6; --hdr-b:#2382e0;
      --bg-a:#0f5fb6; --bg-b:#2382e0;
      --ink:#111; --ink-dim:#334155;
      --card:#ffffff; --card-b:#e5e7eb;
      --btn-blue:#1766d8; --btn-green:#24a35f;
    }
    body{
  /* å…¶ä»–å±¬æ€§ä¸å‹• */
  background: linear-gradient(180deg, var(--bg-a) 0%, var(--bg-b) 72%, #f7fafc 100%);
}
    header{
      color:#fff; padding:1.1rem 1rem .9rem; text-align:center;
      background: linear-gradient(135deg,var(--hdr-a),var(--hdr-b));
      border-bottom:1px solid rgba(255,255,255,.35);
    }
    h1{ margin:0; font-size:1.6rem; letter-spacing:.02em; }
    #marquee{ overflow:hidden; white-space:nowrap; animation:marquee 28s linear infinite;
              font-weight:800; margin-top:.35rem; opacity:.95; }
    @keyframes marquee{0%{transform:translateX(100%);}100%{transform:translateX(-100%);}}
    @media (prefers-reduced-motion:reduce){ #marquee{ animation:none; white-space:normal; } }
    main{ padding:1.2rem 0 2.2rem; flex:1; }
    .wrap{ max-width:520px; margin:0 auto; padding:0 16px; }
    .card{
      background:rgba(255,255,255,.78); border:1px solid var(--card-b);
      border-radius:16px; padding:1.25rem; box-shadow:0 10px 24px rgba(0,0,0,.08);
      backdrop-filter:blur(6px); text-align:left; margin-bottom:1.6rem;
    }
    .card h2{ margin:.2rem 0 .6rem; font-size:1.25rem; }
    /* Unified buttons for <a> and <button> */
    a.btn, button.btn{ display:inline-flex; align-items:center; justify-content:center;
      width:100%; margin:.8rem 0; padding:1rem;
      font-size:1rem; font-weight:800; border:none; border-radius:16px; color:#fff;
      text-decoration:none; box-shadow:0 3px 10px rgba(0,0,0,.14);
      transition: filter .15s ease, transform .05s ease; }
    .btn:hover{ filter:brightness(1.03); }
    .btn:active{ transform:translateY(1px); }
    .primary{ background:linear-gradient(180deg, var(--btn-blue), #3a86e9); }
    .secondary{ background:linear-gradient(180deg, var(--btn-green), #1e8f54); }
    footer{ margin-top:auto; display:flex; justify-content:center; padding:16px; background:transparent; }
    .footer-card {
  background: #fff;
  border-radius: 8px;
  padding: 6px 12px;
  font-size: 12px;
  text-align: center;
  color: #333;

  position: fixed;      /* ğŸ”¹æ”¹é€™è£¡ï¼šå›ºå®šå®šä½ */
  bottom: 8px;          /* ğŸ”¹é›¢åº•éƒ¨ 8pxï¼Œå¯ä»¥è‡ªè¡Œèª¿æ•´ */
  left: 50%;            /* ğŸ”¹æ°´å¹³ç½®ä¸­ */
  transform: translateX(-50%); 

  box-shadow: 0 2px 6px rgba(0,0,0,0.1);  /* é™°å½±å¯ç•™å¯å» */
  z-index: 1000;        /* ğŸ”¹ç¢ºä¿ä¸æœƒè¢«å…¶ä»–å…§å®¹è“‹æ‰ */
}
    .modal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.55);
            padding:max(12px, env(safe-area-inset-top)) 12px max(12px, env(safe-area-inset-bottom)) 12px; z-index:100; }
    .modal[open]{ display:block; }
    .modal-content{
      background:#fff; color:#000; width:calc(100% - 24px); max-width:720px;
      margin:0 auto; padding:18px 18px 16px; border-radius:18px; border:1px solid #e5e7eb;
      max-height:calc(100svh - 2*max(12px, env(safe-area-inset-top)) - 24px);
      overflow:auto; -webkit-overflow-scrolling:touch;
      box-shadow:0 12px 32px rgba(0,0,0,.20);
    }
    .modal-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:.4rem; }
    .close{ background:none; border:none; font-size:28px; cursor:pointer; color:#2563eb; }
    .fields{ display:flex; gap:.75rem; flex-wrap:wrap; align-items:center; margin:.2rem 0 .75rem; }
    .field{ display:flex; flex-direction:column; gap:.35rem; font-weight:800; color:#111; }
    .field input, .field select{
      width:210px; max-width:210px;
      background:#fff; color:#000; border:1px solid #d1d5db; border-radius:12px;
      padding:.55rem .8rem; font-size:.95rem; box-shadow:0 1px 2px rgba(0,0,0,.06);
    }
    .modal-actions{ display:flex; gap:.9rem; margin:.4rem 0 1rem; }
    .modal-actions .btn{ flex:1; margin:0; min-width:0; padding:.95rem; border-radius:20px; }
    .grid{ display:grid; gap:.85rem; grid-template-columns:1fr; }
    .menu{ border:1px solid #e5e7eb; border-radius:16px; padding:1rem; background:#fff; color:#000; }
    .menu h3{ margin:.2rem 0 .5rem; font-size:1.15rem; font-weight:900; }
    .meta{ font-size:.95rem; color:#334155; }
    .pill{ display:inline-block; padding:.32rem .6rem; margin-right:.35rem; border-radius:999px;
           border:1px solid #e5e7eb; background:#f8fafc; color:#475569; font-size:.82rem; font-weight:800; }
    .note{ margin:.45rem 0 0; font-size:.88rem; color:#475569; }
    #calories{ margin-top:.6rem; font-weight:900; }
    .badge{ display:inline-block; padding:.3rem .6rem; border-radius:999px; border:1px solid #f2f2f2; font-size:.82rem; margin-bottom:.35rem; }
    .badge.b{ background:#fff2ec; color:#b93815; }
    .badge.l{ background:#eef5ff; color:#0b6bcf; }
    .badge.d{ background:#ecfdf3; color:#067647; }
    a{ color:#1456c4; }
    /* ===== æ¨™é¡Œå‹•ç•«ï¼šå½ˆè·³ + å‘¼å¸ ===== */
.title-bounce {
  display: inline-block;
  animation: bounce 1.5s infinite;
}
@keyframes bounce {
  0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
  40% { transform: translateY(-8px); }
  60% { transform: translateY(-4px); }
}

.title-breath {
  animation: breath 3s ease-in-out infinite;
}
@keyframes breath {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.05); opacity: 0.85; }
}
  </style>
</head>
<body>
<header>
 <h1 id="main-title">äºŒç‡Ÿå¥åº·ç®¡ç†ä¸­å¿ƒ</h1>
  <div id="marquee">å¥åº·æ¨™èªè¼‰å…¥ä¸­...</div>
</header>

<main>
  <div class="wrap">
    <section class="card">
      <h2>ä»Šæ—¥å€¼ç­äººå“¡</h2>
      <p>å°‘å°‰é¾ä¿Šä½‘ <a href="tel:0938000372">0938-000-372</a><br>ä¸Šå£«æå•Ÿç¥¥ <a href="tel:0955797745">0955-797-745</a></p>
      <small id="dutyWindow" data-auto="1" data-cycle="wed" data-length="7">å€¼ç­æ™‚é–“ï¼š114å¹´08æœˆ20æ—¥ ï½ 114å¹´08æœˆ27æ—¥</small>
    </section>

    <!-- Restore visible link as <a> -->
    <a id="bmiLink" class="btn primary" href="https://forms.gle/cr3efubbA1WoArfp6" target="_blank" rel="noopener">BMI å›å ±</a>
    <button id="menuBtn" class="btn secondary" type="button" aria-haspopup="dialog" aria-controls="menuModal">ä»Šæ—¥å»ºè­°èœå–®</button>
  </div>
</main>

<div id="menuModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="menuTitle">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="menuTitle" style="margin:0;">ä»Šæ—¥å»ºè­°èœå–®</h2>
      <button id="closeMenu" class="close" aria-label="é—œé–‰">&times;</button>
    </div>

    <div class="fields">
      <label class="field">é£²é£Ÿåå¥½ï¼š
        <select id="dietSelect">
          <option value="all">ä¸é™åˆ¶</option>
          <option value="veg">ç´ é£Ÿï¼ˆåš´æ ¼ï¼‰</option>
          <option value="hp">é«˜è›‹ç™½</option>
          <option value="lc">ä½é†£</option>
        </select>
      </label>
      <label class="field">æ¯å¤©ç›®æ¨™ç†±é‡(kcal)ï¼š
        <input id="calTarget" type="number" placeholder="ä¾‹å¦‚ 1800" min="800" max="4000" step="50">
      </label>
    </div>

    <div class="modal-actions">
      <button id="randBtn" class="btn primary" type="button">éš¨æ©Ÿèœå–®</button>
      <button id="byWeekBtn" class="btn secondary" type="button">ä¾æ˜ŸæœŸèœå–®</button>
    </div>

    <div id="menuList" class="grid"></div>
    <p id="calories"></p>
    <p id="warn" style="display:none;color:#b45309;background:#fff7ed;border:1px solid #fed7aa;padding:.6rem .8rem;border-radius:10px;font-weight:700;"></p>
  </div>
</div>

<footer>
  <div class="footer-card">&copy; <span id="rocYear"></span> äºŒç‡Ÿå¥åº·ç®¡ç†ä¸­å¿ƒ</div>
</footer>

<script>
// ===== Theme pool =====
const THEMES = [
  { a:"#0f5fb6", b:"#2382e0", midA:"#0f5fb6", midB:"#2382e0" },
  { a:"#6a11cb", b:"#2575fc", midA:"#5f65d6", midB:"#6bb0ff" },
  { a:"#d53369", b:"#daae51", midA:"#d64467", midB:"#e9c074" },
  { a:"#11998e", b:"#38ef7d", midA:"#158f86", midB:"#7cefa4" }
];
const theme = THEMES[Math.floor(Math.random()*THEMES.length)];
for (const [k,v] of Object.entries({ '--hdr-a':theme.a, '--hdr-b':theme.b, '--bg-a':theme.midA, '--bg-b':theme.midB })){
  document.documentElement.style.setProperty(k, v);
}
// slogans
const slogans=["å‡è¡¡é£²é£Ÿï¼Œé«”èƒ½å¸¸é’","å¤šå–æ°´ï¼Œå°‘å–å«ç³–é£²æ–™","ç¡çœ å……è¶³ï¼Œç²¾ç¥ç™¾å€","è¦å¾‹é‹å‹•ï¼Œå¼·å¥é«”é­„","æ‹’è¸é…’æª³æ¦”ï¼Œå¥åº·ä¸€ç”Ÿ","ä¸‰é¤å®šæ™‚å®šé‡ï¼Œå°‘åƒå®µå¤œ","æ§åˆ¶é«”é‡ï¼Œå®ˆè­·æˆ°åŠ›","æ¯é€±è‡³å°‘é‹å‹•150åˆ†é˜","å°‘æ²¹å°‘é¹½å°‘ç³–ï¼Œå¤šè”¬æœé«˜çº–ç¶­"];
document.getElementById('marquee').textContent=slogans[Math.floor(Math.random()*slogans.length)];
// duty window
(function(){
  const el=document.getElementById('dutyWindow'); if(!el) return;
  const pad2=n=>String(n).padStart(2,'0'); const toRoc=d=>`${d.getFullYear()-1911}å¹´${pad2(d.getMonth()+1)}æœˆ${pad2(d.getDate())}æ—¥`;
  if(el.dataset.auto==='1'){
    const map={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6};
    const startDow=map[(el.dataset.cycle||'wed')]; const len=parseInt(el.dataset.length||'7',10);
    const now=new Date(); const diff=(now.getDay()-startDow+7)%7;
    const s=new Date(now); s.setDate(now.getDate()-diff); s.setHours(0,0,0,0);
    const e=new Date(s); e.setDate(s.getDate()+len); e.setHours(23,59,59,999);
    el.textContent=`å€¼ç­æ™‚é–“ï¼š${toRoc(s)} ï½ ${toRoc(e)}`;
  }
  document.getElementById('rocYear').textContent=String(new Date().getFullYear()-1911);
})();
// Pools
const breakfastPool = [
  {name:"å…¨éº¥åå¸ï¼‹ä½è„‚ç‰›å¥¶", kcal:300, tags:[]},
  {name:"ç‡•éº¥ï¼‹æ°´ç…®è›‹ï¼‹ç„¡ç³–è±†æ¼¿", kcal:350, tags:["hp","veg"]},
  {name:"ç„¡ç³–å„ªæ ¼ï¼‹å …æœï¼‹æ°´æœ", kcal:300, tags:["veg","lc"]},
  {name:"æ°´ç…®è›‹ï¼‹ç‡•éº¥ç²¥", kcal:340, tags:["hp"]},
  {name:"å…¨éº¥é¥…é ­ï¼‹è±†æ¼¿", kcal:360, tags:["veg"]},
  {name:"æ°´ç…®è›‹ï¼‹é»‘å’–å•¡ï¼‹æ°´æœ", kcal:260, tags:["lc","hp"]},
  {name:"ç‡•éº¥ç‰‡ï¼‹å …æœï¼‹ç‰›å¥¶", kcal:370, tags:[]},
  {name:"è±†æ¼¿ï¼‹åœ°ç“œï¼‹æ™‚è”¬", kcal:320, tags:["veg"]},
  {name:"è”¬èœè›‹é¤…ï¼ˆå°‘æ²¹ï¼‰ï¼‹ç„¡ç³–èŒ¶", kcal:330, tags:["lc"]},
  {name:"å„ªæ ¼æ°´æœç¢—ï¼‹å¥‡äºç±½", kcal:310, tags:["veg","lc"]}
];
const lunchPool = [
  {name:"é›èƒ¸è‚‰ï¼‹ç³™ç±³ï¼‹ç‡™é’èœ", kcal:500, tags:["hp"]},
  {name:"é®­é­šï¼‹ç³™ç±³ï¼‹é’èŠ±èœ", kcal:560, tags:["hp","lc"]},
  {name:"é›è…¿æ’ï¼‹ç³™ç±³ï¼‹æ™‚è”¬", kcal:540, tags:["hp"]},
  {name:"ç‰›è‚‰ç‰‡ï¼‹åœ°ç“œï¼‹é’èœ", kcal:560, tags:["hp"]},
  {name:"é®­é­šï¼‹åœ°ç“œï¼‹é’èœ", kcal:540, tags:["hp","lc"]},
  {name:"é›èƒ¸è‚‰ä¾¿ç•¶ï¼ˆåŠé£¯ï¼‰ï¼‹æ™‚è”¬", kcal:500, tags:["hp","lc"]},
  {name:"è‡è‡æ™‚è”¬ç‚’éºµï¼‹æ°´ç…®è›‹", kcal:520, tags:["veg"]},
  {name:"è±†è…æ™‚è”¬è“‹é£¯ï¼ˆåŠé£¯ï¼‰", kcal:480, tags:["veg","lc"]},
  {name:"è’œé¦™æé®‘è‡ï¼‹è—œéº¥æ²™æ‹‰", kcal:450, tags:["veg","lc"]},
  {name:"æ—¥å¼è±†è…é‹ï¼‹è”¬èœï¼‹å°‘é‡ç™½é£¯", kcal:520, tags:["veg"]}
];
const dinnerPool = [
  {name:"è”¬èœæ¹¯ï¼‹è±†è…ï¼‹æ°´æœ", kcal:300, tags:["veg","lc"]},
  {name:"è’¸è›‹ï¼‹ç‚’è èœï¼‹æ°´æœ", kcal:320, tags:["veg","lc"]},
  {name:"è±†æ¼¿ï¼‹é›èƒ¸æ²™æ‹‰", kcal:290, tags:["lc"]},
  {name:"å‘³å™Œæ¹¯ï¼‹è±†è…ï¼‹æ°´æœ", kcal:310, tags:["veg","lc"]},
  {name:"è”¬èœæ¹¯ï¼‹é›è›‹ï¼‹æ°´æœ", kcal:290, tags:["veg","lc"]},
  {name:"è±†æ¼¿ï¼‹ç‚’é’èœ", kcal:270, tags:["veg","lc"]},
  {name:"è’¸é±¸é­šï¼‹èŠ±æ¤°èœï¼‹å±±è—¥", kcal:340, tags:["hp","lc"]},
  {name:"ç•ªèŒ„è±†è…é‹ï¼‹æ™‚è”¬", kcal:320, tags:["veg"]},
  {name:"ç‰ç±³ç­ç‚’è‡ï¼‹æ¶¼æ‹Œè±†å¹²", kcal:300, tags:["veg","lc"]},
  {name:"çƒ¤é›è…¿ï¼‹æ²™æ‹‰ï¼ˆç„¡é†¬ï¼‰", kcal:330, tags:["hp","lc"]}
];
const menusByWeek = [
  [{t:"æ—©é¤", name:"å…¨éº¥åå¸ï¼‹ä½è„‚ç‰›å¥¶", kcal:300, tags:[]},
   {t:"åˆé¤", name:"é®­é­šï¼‹ç³™ç±³ï¼‹é’èŠ±èœ", kcal:560, tags:["hp","lc"]},
   {t:"æ™šé¤", name:"è”¬èœæ¹¯ï¼‹è±†è…ï¼‹æ°´æœ", kcal:300, tags:["veg","lc"]}],

  [{t:"æ—©é¤", name:"ç‡•éº¥ï¼‹æ°´ç…®è›‹ï¼‹ç„¡ç³–è±†æ¼¿", kcal:350, tags:["hp","veg"]},
   {t:"åˆé¤", name:"é›èƒ¸è‚‰ï¼‹ç³™ç±³ï¼‹ç‡™é’èœ", kcal:500, tags:["hp"]},
   {t:"æ™šé¤", name:"è’¸è›‹ï¼‹ç‚’è èœï¼‹æ°´æœ", kcal:320, tags:["veg","lc"]}],

  [{t:"æ—©é¤", name:"ç„¡ç³–å„ªæ ¼ï¼‹å …æœï¼‹æ°´æœ", kcal:300, tags:["veg","lc"]},
   {t:"åˆé¤", name:"é›è…¿æ’ï¼‹ç³™ç±³ï¼‹æ™‚è”¬", kcal:540, tags:["hp"]},
   {t:"æ™šé¤", name:"è±†æ¼¿ï¼‹é›èƒ¸æ²™æ‹‰", kcal:290, tags:["lc"]}],

  [{t:"æ—©é¤", name:"æ°´ç…®è›‹ï¼‹ç‡•éº¥ç²¥", kcal:340, tags:["hp"]},
   {t:"åˆé¤", name:"ç‰›è‚‰ç‰‡ï¼‹åœ°ç“œï¼‹é’èœ", kcal:560, tags:["hp"]},
   {t:"æ™šé¤", name:"å‘³å™Œæ¹¯ï¼‹è±†è…ï¼‹æ°´æœ", kcal:310, tags:["veg","lc"]}],

  [{t:"æ—©é¤", name:"å…¨éº¥é¥…é ­ï¼‹è±†æ¼¿", kcal:360, tags:["veg"]},
   {t:"åˆé¤", name:"è‡è‡æ™‚è”¬ç‚’éºµï¼‹æ°´ç…®è›‹", kcal:520, tags:["veg"]},
   {t:"æ™šé¤", name:"è”¬èœæ¹¯ï¼‹é›è›‹ï¼‹æ°´æœ", kcal:290, tags:["veg","lc"]}],

  [{t:"æ—©é¤", name:"æ°´ç…®è›‹ï¼‹é»‘å’–å•¡ï¼‹æ°´æœ", kcal:260, tags:["lc","hp"]},
   {t:"åˆé¤", name:"é®­é­šï¼‹åœ°ç“œï¼‹é’èœ", kcal:540, tags:["hp","lc"]},
   {t:"æ™šé¤", name:"è±†æ¼¿ï¼‹ç‚’é’èœ", kcal:270, tags:["veg","lc"]}],

  [{t:"æ—©é¤", name:"ç‡•éº¥ç‰‡ï¼‹å …æœï¼‹ç‰›å¥¶", kcal:370, tags:[]},
   {t:"åˆé¤", name:"é›èƒ¸è‚‰ä¾¿ç•¶ï¼ˆåŠé£¯ï¼‰ï¼‹æ™‚è”¬", kcal:500, tags:["hp","lc"]},
   {t:"æ™šé¤", name:"ç•ªèŒ„è±†è…é‹ï¼‹æ™‚è”¬", kcal:320, tags:["veg"]}]
];
function shuffle(a){ const b=[...a]; for(let i=b.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [b[i],b[j]]=[b[j],b[i]];} return b; }
function pickFromPool(pool, filterTag, need=1){
  const list = filterTag ? pool.filter(x => (x.tags||[]).includes(filterTag)) : pool.slice();
  return shuffle(list).slice(0, need);
}
function buildByPreference(pref){
  const warn = document.getElementById('warn');
  warn.style.display = 'none';
  if(pref === 'veg'){
    const b = pickFromPool(breakfastPool, 'veg', 1);
    const l = pickFromPool(lunchPool, 'veg', 1);
    const d = pickFromPool(dinnerPool, 'veg', 1);
    const chosen = [
      {t:"æ—©é¤", ...(b[0]||{name:"ï¼ˆç¼ºé …ï¼‰",kcal:0,tags:["veg"]})},
      {t:"åˆé¤", ...(l[0]||{name:"ï¼ˆç¼ºé …ï¼‰",kcal:0,tags:["veg"]})},
      {t:"æ™šé¤", ...(d[0]||{name:"ï¼ˆç¼ºé …ï¼‰",kcal:0,tags:["veg"]})}
    ];
    if(!b.length || !l.length || !d.length){
      warn.textContent = "âš ï¸ ç´ é£Ÿåš´æ ¼æ¨¡å¼ä¸‹ï¼Œä»Šæ—¥èœå–®æ± ä¸è¶³ï¼Œè«‹æ‰‹å‹•è£œé½Šæˆ–èª¿æ•´åå¥½ã€‚";
      warn.style.display = 'block';
    }
    return chosen;
  }
  const tag = (pref==='hp' || pref==='lc') ? pref : null;
  const pickOrFallback = (pool)=>{
    const primary = pickFromPool(pool, tag, 1);
    if(primary.length) return primary[0];
    return shuffle(pool)[0];
  };
  return [
    {t:"æ—©é¤", ...pickOrFallback(breakfastPool)},
    {t:"åˆé¤", ...pickOrFallback(lunchPool)},
    {t:"æ™šé¤", ...pickOrFallback(dinnerPool)}
  ];
}
function render(list){
  const badgeClass = t => t==="æ—©é¤"?"b":(t==="åˆé¤"?"l":"d");
  document.getElementById("menuList").innerHTML = list.map(i=>`
    <article class="menu">
      <span class="badge ${badgeClass(i.t)}">${i.t}</span>
      <h3>${i.name}</h3>
      <p class="meta">ç†±é‡ï¼šç´„ ${i.kcal} kcal ${(i.tags||[]).map(tag=>`<span class="pill">${tag}</span>`).join("")}</p>
      <p class="note">å»ºè­°ï¼šé¤ç›¤ 1/2 è”¬èœã€1/4 è›‹ç™½ã€1/4 å…¨ç©€ï¼›å¤–é£Ÿå¯æ¸›é£¯åŠç¢—æˆ–å»çš®ã€‚</p>
    </article>
  `).join("");
  const total = list.reduce((a,b)=>a+(b.kcal||0),0);
  const target = parseInt(document.getElementById('calTarget').value||"0",10);
  const delta = target? `ï¼ˆèˆ‡ç›®æ¨™å·®è·ï¼šç´„ ${Math.abs(total-target)} kcal ${total>target?"å¯æ¸›å°‘":"å¯åŠ é¤"}ï¼‰` : "";
  document.getElementById("calories").textContent = `æ¯æ—¥ç¸½ç†±é‡ï¼šç´„ ${total} kcal ${delta}`;
}
function currentDayList(){ return menusByWeek[new Date().getDay()%menusByWeek.length]; }
// Buttons
const modal=document.getElementById('menuModal');
document.getElementById('menuBtn').addEventListener('click',()=>{ modal.setAttribute('open',''); document.body.style.overflow='hidden'; document.getElementById('warn').style.display='none'; render(currentDayList()); });
document.getElementById('closeMenu').addEventListener('click',()=>{ modal.removeAttribute('open'); document.body.style.overflow=''; });
window.addEventListener('click',e=>{ if(e.target===modal){ modal.removeAttribute('open'); document.body.style.overflow=''; }});
// Actions
document.getElementById('randBtn').addEventListener('click',()=>{
  const pref = document.getElementById('dietSelect').value;
  const base = buildByPreference(pref);
  let next = base;
  const key = 'menuSignature';
  const sig = next.map(x=>x.t+":"+x.name).join('|');
  if(localStorage.getItem(key)===sig){ next = buildByPreference(pref); }
  localStorage.setItem(key, sig);
  render(next);
});
document.getElementById('byWeekBtn').addEventListener('click',()=>{
  const pref = document.getElementById('dietSelect').value;
  if(pref==='veg'){
    const source = currentDayList();
    const replaced = source.map(item=>{
      if((item.tags||[]).includes('veg')) return item;
      // FIXED: proper JS conditional for selecting pool by meal type
      const pool = item.t==="æ—©é¤" ? breakfastPool : (item.t==="åˆé¤" ? lunchPool : dinnerPool);
      const alt = pool.filter(x=> (x.tags||[]).includes('veg'));
      return {t:item.t, ...(alt.length? alt[Math.floor(Math.random()*alt.length)] : {name:"ï¼ˆç¼ºé …ï¼‰",kcal:0,tags:["veg"]})};
    });
    const warn = document.getElementById('warn');
    if(replaced.some(x=>x.name==="ï¼ˆç¼ºé …ï¼‰")){
      warn.textContent = "âš ï¸ ç´ é£Ÿåš´æ ¼æ¨¡å¼ä¸‹ï¼Œä¾æ˜ŸæœŸèœå–®å«æœ‰ç¼ºé …ï¼Œè«‹æ‰‹å‹•è£œé½Šæˆ–æ”¹ç”¨æŠ½ç±¤ã€‚";
      warn.style.display = 'block';
    }else{
      warn.style.display = 'none';
    }
    render(replaced);
  }else{
    document.getElementById('warn').style.display='none';
    render(currentDayList());
    // ===== æ¨™é¡Œå‹•ç•«ï¼šæ¯æ¬¡è¼‰å…¥éš¨æ©Ÿå¥—ç”¨ã€Œå½ˆè·³ã€æˆ–ã€Œå‘¼å¸ã€ =====
(() => {
  const title = document.getElementById('main-title');
  if (!title) return;
  const effects = ['title-bounce', 'title-breath'];
  const randomClass = effects[Math.floor(Math.random() * effects.length)];
  title.classList.add(randomClass);
})();
  }
});
</script>
</body>
</html>
