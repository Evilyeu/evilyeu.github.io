<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>二營健康管理中心</title>
  <meta name="color-scheme" content="light dark">
  <style>
    :root{
      --ink:#222;
      --panel: rgba(255,255,255,0.55);
      --glass-brd: rgba(255,255,255,0.35);
      --shadow: 0 4px 14px rgba(0,0,0,0.14);
      --brand: rgba(0,77,153,0.66);
      --primary: rgba(0,123,255,0.86);
      --secondary: rgba(40,167,69,0.86);
      --focus: 0 0 0 3px rgba(0,123,255,0.35);
      --bg: linear-gradient(135deg,#e7f0ff,#d7ecff);
      --bg-anim: hue-rotate(0deg);
      --anim-duration: 30s;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --ink:#f2f2f2;
        --panel: rgba(40,40,50,0.55);
        --glass-brd: rgba(255,255,255,0.18);
        --shadow: 0 6px 18px rgba(0,0,0,0.35);
        --brand: rgba(0,77,153,0.5);
      }
    }
    html, body { max-width:100%; overflow-x:hidden; -webkit-text-size-adjust:100%; }
    body{
      margin:0;font-family:Arial,"Noto Sans TC",sans-serif;
      color:var(--ink);min-height:100vh;
      background:var(--bg);background-size:cover;
      animation:bgcycle var(--anim-duration) linear infinite;
    }
    @keyframes bgcycle{0%{filter:var(--bg-anim);}100%{filter:hue-rotate(360deg);}}
    @media (prefers-reduced-motion: reduce){body{animation:none;}}
    header{background:var(--brand);color:#fff;padding:1rem;text-align:center;}
    h1{margin:0;font-size:1.5rem;}
    #marquee{white-space:nowrap;animation:marquee 28s linear infinite;font-weight:700;margin-top:.5rem;}
    @keyframes marquee{0%{transform:translateX(100%);}100%{transform:translateX(-100%);}}
    @media (prefers-reduced-motion: reduce){#marquee{animation:none;white-space:normal;}}
    main{text-align:center;padding:2rem 1rem;}
    .card{max-width:520px;margin:0 auto 2rem;padding:1.25rem;background:var(--panel);border-radius:14px;box-shadow:var(--shadow);}
    .btn{display:block;width:min(520px,92vw);margin:1rem auto;padding:1rem;font-size:1rem;font-weight:600;border:none;border-radius:12px;cursor:pointer;color:#fff;}
    .btn.primary{background:var(--primary);}
    .btn.secondary{background:var(--secondary);}
    footer{text-align:center;padding:1rem;margin-top:2rem;background:rgba(255,255,255,0.3);}
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);padding:1rem;}
    .modal[open]{display:block;}
    .modal-content{background:rgba(255,255,255,0.95);color:#000;margin:4% auto;padding:20px;border-radius:12px;width:min(720px,92vw);max-height:calc(100svh - 2rem);overflow:auto;}
    .menu-card{border:1px solid var(--glass-brd);border-radius:12px;padding:.75rem .9rem;background:#fff;color:#000;}
    .pill{display:inline-block;padding:.35rem .6rem;border-radius:999px;background:rgba(0,0,0,.06);font-size:.82rem;margin:.15rem .25rem 0 0;}
    a[href^="tel"]{color:inherit;text-decoration:none;}
    body.modal-open{overflow:hidden;}
    #dietSelect,#calTarget{background:#fff!important;color:#000!important;border:1px solid #ccc;border-radius:12px;padding:10px 12px;width:100%;max-width:14rem;}
  </style>
</head>
<body>
<header>
  <h1>二營健康管理中心</h1>
  <div id="marquee">健康標語載入中...</div>
</header>
<main>
  <section class="card">
    <h2>今日值班人員</h2>
    <p>少尉鍾俊佑 <a href="tel:0938000372">0938-000-372</a><br>
       上士李啟祥 <a href="tel:0955797745">0955-797-745</a></p>
    <small id="dutyWindow" data-auto="1" data-cycle="tue" data-length="7">值班時間：114年08月20日 ～ 114年08月27日</small>
  </section>
  <a class="btn primary" href="https://forms.gle/cr3efubbA1WoArfp6" target="_blank">BMI 回報</a>
  <button id="menuBtn" class="btn secondary">今日建議減脂菜單</button>
</main>
<div id="menuModal" class="modal">
  <div class="modal-content">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h2>今日建議菜單</h2>
      <button id="closeMenu" class="close">&times;</button>
    </div>
    <div>
      <label>飲食偏好：<select id="dietSelect">
        <option value="all">不限制</option><option value="veg">素食</option><option value="hp">高蛋白</option><option value="lc">低醣</option>
      </select></label>
      <label>每天目標熱量(kcal)：<input id="calTarget" type="number" placeholder="例如 1800"></label>
      <button id="randBtn" class="btn primary">抽籤（避免重複）</button>
      <button id="byWeekBtn" class="btn secondary">依星期菜單</button>
    </div>
    <div id="menuSummary" class="muted"></div>
    <div id="menuList"></div>
    <p id="calories"></p>
  </div>
</div>
<footer><p>&copy; <span id="rocYear"></span> 二營健康管理中心</p></footer>
<script>
const slogans=["均衡飲食，體能常青","多喝水，少喝含糖飲料","睡眠充足，精神百倍","規律運動，強健體魄","拒菸酒檳榔，健康一生","三餐定時定量，少吃宵夜","控制體重，守護戰力","壓力釋放，心理健康","每週至少運動150分鐘","少油少鹽少糖，多蔬果高纖維"];
document.getElementById('marquee').textContent=slogans[Math.floor(Math.random()*slogans.length)];
const menus=[[{meal:"早餐：燕麥＋水煮蛋＋無糖豆漿",kcal:350,tags:["hp"]},{meal:"午餐：雞胸肉＋糙米＋燙青菜",kcal:500,tags:["hp"]},{meal:"晚餐：蔬菜湯＋豆腐＋水果",kcal:300,tags:["veg"]}],
[{meal:"早餐：全麥吐司＋低脂牛奶",kcal:300,tags:[]},{meal:"午餐：鮭魚＋糙米＋青花菜",kcal:550,tags:["hp","lc"]},{meal:"晚餐：蒸蛋＋炒菠菜＋水果",kcal:320,tags:["veg","lc"]}],
[{meal:"早餐：無糖優格＋堅果＋水果",kcal:280,tags:["veg","lc"]},{meal:"午餐：雞腿排＋糙米＋時蔬",kcal:520,tags:["hp"]},{meal:"晚餐：豆漿＋沙拉",kcal:250,tags:["veg","lc"]}],
[{meal:"早餐：水煮蛋＋燕麥粥",kcal:330,tags:["hp"]},{meal:"午餐：牛肉片＋地瓜＋青菜",kcal:560,tags:["hp"]},{meal:"晚餐：味噌湯＋豆腐＋水果",kcal:310,tags:["veg","lc"]}],
[{meal:"早餐：全麥饅頭＋豆漿",kcal:340,tags:["veg"]},{meal:"午餐：菇菇時蔬炒麵＋水煮蛋",kcal:500,tags:["veg"]},{meal:"晚餐：蔬菜湯＋雞蛋＋水果",kcal:280,tags:["veg"]}],
[{meal:"早餐：水煮蛋＋黑咖啡＋水果",kcal:260,tags:["lc"]},{meal:"午餐：鮭魚＋地瓜＋青菜",kcal:540,tags:["hp","lc"]},{meal:"晚餐：豆漿＋炒青菜",kcal:270,tags:["veg","lc"]}],
[{meal:"早餐：燕麥片＋堅果＋牛奶",kcal:360,tags:[]},{meal:"午餐：雞胸肉＋糙米＋燙青菜",kcal:500,tags:["hp","lc"]},{meal:"晚餐：蔬菜湯＋豆腐＋水果",kcal:310,tags:["veg","lc"]}]];
// 擴充素食 randomPool
const randomPool=[
{meal:"早餐：全麥饅頭＋無糖豆漿",kcal:340,tags:["veg"]},
{meal:"早餐：無糖優格＋綜合堅果＋水果",kcal:320,tags:["veg","lc"]},
{meal:"早餐：蔬菜蛋餅（少油）＋豆漿",kcal:360,tags:["veg"]},
{meal:"午餐：日式照燒豆腐丼（半飯）",kcal:480,tags:["veg"]},
{meal:"午餐：菇菇時蔬炒麵＋荷包蛋",kcal:520,tags:["veg"]},
{meal:"午餐：五穀米飯＋滷海帶＋涼拌豆干",kcal:500,tags:["veg"]},
{meal:"午餐：鷹嘴豆蔬菜沙拉＋藜麥",kcal:460,tags:["veg","lc"]},
{meal:"晚餐：三色蔬菜湯＋板豆腐",kcal:300,tags:["veg","lc"]},
{meal:"晚餐：蒸蛋＋炒青江菜＋小番茄",kcal:330,tags:["veg","lc"]},
{meal:"晚餐：時蔬冷盤＋毛豆80g＋水果",kcal:310,tags:["veg","lc"]},
{meal:"早餐：地瓜200g＋無糖優格",kcal:320,tags:["veg","lc"]},
{meal:"早餐：豆漿燕麥香蕉昔",kcal:360,tags:["veg"]},
{meal:"午餐：火雞胸沙拉＋玉米半根",kcal:420,tags:["hp","lc"]},
{meal:"晚餐：蒸鱈魚＋花椰菜＋山藥",kcal:340,tags:["hp","lc"]},
{meal:"晚餐：雞絲小黃瓜涼拌＋皮蛋豆腐",kcal:300,tags:["hp","lc"]},
];
function filterByPref(items,pref){
  if(pref==='veg')return items.filter(i=>i.tags?.includes('veg'));
  if(pref==='hp')return items.filter(i=>i.tags?.includes('hp'));
  if(pref==='lc')return items.filter(i=>i.tags?.includes('lc'));
  return items;
}
function renderMenuCards(list,pref,target,title){
  document.getElementById('menuList').innerHTML=list.map(i=>`<div class="menu-card"><p>${i.meal}</p><p>熱量：約 ${i.kcal} kcal</p></div>`).join('');
  const total=list.reduce((a,b)=>a+b.kcal,0);
  document.getElementById('calories').textContent=`每日總熱量：約 ${total} kcal`;
}
function pickOne(type,prefPool,fullPool){
  const re=new RegExp('^'+type);
  const p=prefPool.filter(i=>re.test(i.meal));
  if(p.length)return p[Math.floor(Math.random()*p.length)];
  const r=filterByPref(randomPool,'veg').filter(i=>re.test(i.meal));
  if(r.length)return r[Math.floor(Math.random()*r.length)];
  return null;
}
function renderByWeek(pref='all',target=null){
  const idx=new Date().getDay();
  const full=menus[idx];const prefPool=filterByPref(full,pref);
  const b=pickOne('早餐',prefPool,full);const l=pickOne('午餐',prefPool,full);const d=pickOne('晚餐',prefPool,full);
  const list=[b,l,d].filter(Boolean);
  renderMenuCards(list,pref,target,"依星期菜單");
}
function renderRandom(pref='all',target=null){
  const idx=new Date().getDay();const pool=menus[idx].concat(randomPool);
  const prefPool=filterByPref(pool,pref);
  const b=pickOne('早餐',prefPool,pool);const l=pickOne('午餐',prefPool,pool);const d=pickOne('晚餐',prefPool,pool);
  const list=[b,l,d].filter(Boolean);
  renderMenuCards(list,pref,target,"抽籤菜單");
}
document.getElementById('randBtn').onclick=()=>{renderRandom(document.getElementById('dietSelect').value);};
document.getElementById('byWeekBtn').onclick=()=>{renderByWeek(document.getElementById('dietSelect').value);};
document.getElementById('menuBtn').onclick=()=>{document.getElementById('menuModal').setAttribute('open','');document.body.classList.add('modal-open');};
document.getElementById('closeMenu').onclick=()=>{document.getElementById('menuModal').removeAttribute('open');document.body.classList.remove('modal-open');};
document.getElementById('rocYear').textContent=new Date().getFullYear()-1911;
renderByWeek();
</script>
</body>
</html>
